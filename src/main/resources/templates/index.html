<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>Mini Habit Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link rel="stylesheet" th:href="@{/css/index.css}">
</head>
<body>
<div th:replace="fragments/header :: siteHeader"></div>
<div class="container">


    <main>
        <section class="hero">
            <h1 class="hero-title">í•˜ë£¨ í•œ ë²ˆ, ì”ë”” ì‹¬ê¸° ìŠµê´€ ë§Œë“¤ê¸°</h1>

            <div class="hero-buttons" sec:authorize="!isAuthenticated()">
                <a class="btn-primary" th:href="@{/user/signup}">ì§€ê¸ˆ ì‹œì‘í•˜ê¸°</a>
                <a class="btn-secondary" th:href="@{/user/login}">ì´ë¯¸ ê³„ì •ì´ ìˆì–´ìš”</a>
            </div>

            <div class="hero-buttons" sec:authorize="isAuthenticated()">
                <a class="btn-primary" th:href="@{/habit/list}">ë‚´ ìŠµê´€ ë³´ëŸ¬ê°€ê¸°</a>
                <a class="btn-secondary" th:href="@{/habit/create}">ìƒˆ ìŠµê´€ ë“±ë¡í•˜ê¸°</a>
            </div>

            <div style="
    margin-top: 24px;
    background-color: #0f172a;
    border-radius: 14px;
    padding: 14px 18px;
    color: #e5e7eb;">
                <div style="font-size: 13px; margin-bottom: 8px;">
                    ì›”ë³„ ì”ë”” ë³´ê¸°
                    <span id="grass-month-label" style="font-size: 12px; color: #9ca3af; margin-left: 6px;"></span>
                </div>

                <!-- ì‹¤ì œ ì”ë””ê°€ ë“¤ì–´ê°ˆ ì˜ì—­ -->
                <div id="grass-grid"
                     style="display: flex; flex-wrap: wrap; gap: 4px;">
                    <!-- JSë¡œ ì‘ì€ ë„¤ëª¨(ì¹¸)ë“¤ì„ ì±„ì›Œ ë„£ì„ ê±°ì•¼ -->
                </div>

                <section class="today-section" sec:authorize="isAuthenticated()"
                         style="margin-top: 20px;">
                    <h2 style="font-size: 15px; font-weight: 600; margin-bottom: 6px;">
                        ì˜¤ëŠ˜ í•´ì•¼ í•  ì¼
                    </h2>

                    <p id="today-empty"
                       style="font-size: 13px; color: #9ca3af; margin: 4px 0; display: none;">
                        ì˜¤ëŠ˜ í•´ì•¼ í•  ì¼ì€ ëª¨ë‘ ì™„ë£Œí–ˆì–´ìš” ğŸ‰
                    </p>

                    <ul id="today-list"
                        style="list-style: none; padding: 0; margin: 0;"></ul>

                    <div style="margin-top: 8px;">
                        <a th:href="@{/habit/list}"
                           style="font-size: 12px; color: #16a34a; text-decoration: none;">
                            ë‚´ ìŠµê´€ í˜ì´ì§€ì—ì„œ ì²´í¬ì¸ í•˜ê¸° â†’
                        </a>
                    </div>
                </section>
            </div>
        </section>

    </main>
</div>
</body>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const grid = document.getElementById("grass-grid");
        const monthLabel = document.getElementById("grass-month-label");

        if (!grid) return;  // í™ˆì´ ì•„ë‹ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ì•ˆì „ ì¥ì¹˜

        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth() + 1; // 1~12

        // ì›” ë¼ë²¨ í‘œì‹œ (ì˜ˆ: 2025-12)
        monthLabel.textContent = `${year}-${String(month).padStart(2, "0")}`;

        // âœ… 1) ì›”ë³„ ì”ë”” ë¡œë”©
        fetch(`/habit/calendar?year=${year}&month=${month}`)
            .then(res => res.json())
            .then(data => {
                const daysInMonth = new Date(year, month, 0).getDate();
                const checkedSet = new Set(data.checkedDays || []);

                for (let day = 1; day <= daysInMonth; day++) {
                    const dot = document.createElement("div");
                    dot.style.width = "14px";
                    dot.style.height = "14px";
                    dot.style.borderRadius = "4px";
                    dot.style.backgroundColor = checkedSet.has(day) ? "#22c55e" : "#1f2937";
                    grid.appendChild(dot);
                }
            })
            .catch(err => {
                console.error("ì”ë”” ë°ì´í„° ë¡œë”© ì‹¤íŒ¨", err);
            });

        // âœ… 2) ì˜¤ëŠ˜ í•´ì•¼ í•  ì¼ ë¡œë”©
        const todayList = document.getElementById("today-list");
        const todayEmpty = document.getElementById("today-empty");

        if (todayList) {
            fetch("/habit/today")
                .then(res => res.json())
                .then(habits => {
                    if (!habits || habits.length === 0) {
                        if (todayEmpty) todayEmpty.style.display = "block";
                        return;
                    }

                   habits.forEach(habit => {
                        const li = document.createElement("li");
                        li.classList.add("today-item");

                        // ì (â€¢) í…ìŠ¤íŠ¸
                        const bullet = document.createTextNode("â€¢ ");

                        // ì‹¤ì œ í´ë¦­ ê°€ëŠ¥í•œ ë§í¬
                        const link = document.createElement("a");
                        link.classList.add("today-link");
                        link.textContent = habit.name;

                        // âœ” ì—¬ê¸°ì„œ ìƒì„¸(ë˜ëŠ” ìˆ˜ì •) í™”ë©´ìœ¼ë¡œ ì´ë™
                        //    - í˜„ì¬ ê°–ê³  ìˆëŠ” edit URL íŒ¨í„´ ì‚¬ìš©: /habit/edit/{id}
                        link.href = `/habit/detail/${habit.id}`;;

                        li.appendChild(bullet);
                        li.appendChild(link);
                        todayList.appendChild(li);
                        });

                })
                .catch(err => {
                    console.error("ì˜¤ëŠ˜ í•  ì¼ ë¡œë”© ì‹¤íŒ¨", err);
                });
        }
    });
</script>

</html>
